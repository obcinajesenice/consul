<!DOCTYPE html>
<html lang="<%= I18n.locale %>" data-current-user-id="<%= current_user.try(:id) %>">
  <head>
    <%= render "layouts/common_head", default_title: setting['org_name'] %>
    <%= render "layouts/tracking_data" %>
    <%= render "layouts/meta_tags" %>
    <%= content_for :canonical %>
    <!--[if lt IE 9]>
      <%= stylesheet_link_tag "ie" %>
    <![endif]-->
    <%= favicon_link_tag image_path_for("apple-touch-icon-200.png"),
                     rel: "icon apple-touch-icon",
                     sizes: "200x200",
                     type: "image/png" %>
    <%= content_for :social_media_meta_tags %>

    <%= setting['per_page_code_head'].try(:html_safe) %>
  </head>
  <body class="<%= yield (:body_class) %>">
    <%= setting['per_page_code_body'].try(:html_safe) %>

    <h1 class="show-for-sr"><%= setting['org_name'] %></h1>

    <div class="wrapper <%= yield (:wrapper_class) %>">
      <%= render 'layouts/header' %>

      <!--[if lt IE 9]>
      <% if browser.ie? && cookies['ie_alert_closed'] != 'true' %>
        <div data-alert class="callout primary ie-callout" data-closable>
          <button class="close-button ie-callout-close-js"
                  aria-label="<%= t("application.close") %>" type="button" data-close>
            <span aria-hidden="true">&times;</span>
          </button>
          <h2><%= t("layouts.application.ie_title") %></h2>
          <p>
            <%= t("layouts.application.ie",
            chrome: link_to(
                    t("layouts.application.chrome"), "https://www.google.com/chrome/browser/desktop/", title: t("shared.target_blank_html"), target: "_blank"),
            firefox: link_to(
                     t("layouts.application.firefox"), "https://www.mozilla.org/firefox", title: t("shared.target_blank_html"), target: "_blank")
            ).html_safe %>
          </p>
        </div>
      <% end %>
      <![endif]-->

      <%= render 'layouts/flash' %>

      <%= yield %>
      <div class="push"></div>
    </div>
    <div class="footer">
      <%= render 'layouts/footer' %>
    </div>

    <script>
    function setCookie(name,value,days) {
      var expires = '';
      if (days) {
        var date = new Date();
        date.setTime(date.getTime() + (days*24*60*60*1000));
        expires = "; expires=" + date.toUTCString();
      }
      document.cookie = name + "=" + (value || "")  + expires + "; path=/";
    }
    function getCookie(name) {
      var nameEQ = name + "=";
      var ca = document.cookie.split(';');
      for(var i=0;i < ca.length;i++) {
        var c = ca[i];
        while (c.charAt(0)==' ') c = c.substring(1,c.length);
        if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
      }
      return null;
    }
    function eraseCookie(name) {   
      document.cookie = name+'=; Max-Age=-99999999;';  
    }
    
    var clicked = false;
    
    var computer = getCookie('computer');
    if (!computer) {
      setCookie('computer', Math.random().toString(36).substring(7), 30);
      computer = getCookie('computer');
    }
    
    $(document).ready(function() {
      $('.button-support').on('click', function(e) {
        console.log(e);
        if (!clicked) {
          _this = e.currentTarget;
          var code = prompt('Prosim vpiÅ¡i svojo kodo.');
    
          if (code !== null && code !== '') {
            $.get('https://api.djnd.si/locker/unlock/?code=' + code + '&computer=' + computer, function(r) {
              if (r === '1') {
                clicked = true;
                $(_this).click();
              } else {
                alert(r);
              }
            });
          } else {
            return false;
          }
          return false;
        } else {
          clicked = true;
        }
      });
    });
    </script>
  </body>
  <!--[if lt IE 9]>
    <%= javascript_include_tag "ie_lt9" %>
  <![endif]-->
</html>
